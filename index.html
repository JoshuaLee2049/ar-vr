<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>City RPG: èˆŠå±±ç·šæ™‚ç©ºç†±ç·š</title>
<style>
  /* --- æ ¸å¿ƒä½ˆå±€ --- */
  body { font-family: 'PingFang TC', 'Microsoft JhengHei', sans-serif; background-color: #111; margin: 0; display: flex; justify-content: center; height: 100vh; overflow: hidden; }
  
  .phone-frame { 
    width: 100%; max-width: 450px; height: 100%; 
    background-color: #7280a8; 
    position: relative; display: flex; flex-direction: column; 
    background-image: linear-gradient(rgba(0,0,0,0.4), rgba(0,0,0,0.4)), url('https://images.unsplash.com/photo-1474487548417-781cb71495f3?auto=format&fit=crop&q=80&w=800');
    background-size: cover; background-position: center;
  }

  /* --- Header --- */
  .header { 
    background: rgba(20, 20, 30, 0.85); color: #fff; padding: 15px 20px; 
    display: flex; align-items: center; gap: 15px; font-weight: bold; backdrop-filter: blur(10px); z-index: 10;
    border-bottom: 1px solid rgba(255,255,255,0.1);
  }
  .back-btn { font-size: 1.2em; cursor: pointer; }
  .chat-title { flex: 1; font-size: 1.1em; }
  .header-icons { font-size: 1.2em; letter-spacing: 15px; opacity: 0.8; }

  /* --- èŠå¤©å€åŸŸ --- */
  .chat-area { 
    flex: 1; padding: 20px 12px; overflow-y: auto; 
    display: flex; flex-direction: column; gap: 18px; scroll-behavior: smooth;
  }
  
  /* è¨Šæ¯æ¨£å¼ */
  .msg-row { display: flex; align-items: flex-start; margin-bottom: 5px; }
  .msg-row.me { justify-content: flex-end; }
  
  .avatar { 
    width: 42px; height: 42px; border-radius: 50%; margin-right: 10px; 
    background-size: cover; border: 1px solid rgba(255,255,255,0.4); flex-shrink: 0;
  }
  
  .sender-name { font-size: 0.75em; color: #ddd; margin-bottom: 4px; margin-left: 2px; text-shadow: 1px 1px 2px black;}
  
  .bubble {
    padding: 10px 14px; border-radius: 18px; font-size: 0.95em; line-height: 1.5; 
    position: relative; max-width: 240px; word-wrap: break-word; box-shadow: 0 2px 4px rgba(0,0,0,0.3);
  }
  
  /* å°æ–¹æ°£æ³¡ */
  .msg-row.other .bubble { background: #fff; color: #333; border-top-left-radius: 2px; }
  .msg-row.other .bubble::before {
    content: ""; position: absolute; left: -8px; top: 0;
    border-top: 0px solid transparent; border-right: 12px solid #fff; border-bottom: 10px solid transparent;
  }
  
  /* æˆ‘çš„æ°£æ³¡ */
  .msg-row.me .bubble { background: #98e165; color: #000; border-top-right-radius: 2px; }
  .msg-row.me .bubble::before {
    content: ""; position: absolute; right: -8px; top: 0;
    border-top: 0px solid transparent; border-left: 12px solid #98e165; border-bottom: 10px solid transparent;
  }

  /* ç³»çµ±/æ™‚é–“è³‡è¨Š */
  .meta-info {
    font-size: 0.7em; color: rgba(255,255,255,0.7);
    display: flex; flex-direction: column; justify-content: flex-end;
    margin: 0 8px 5px 8px; text-align: right; min-width: 35px;
  }
  .msg-row.me .meta-info { text-align: left; align-items: flex-end; }
  .read-status { color: #b3e283; margin-bottom: 2px; font-weight: bold; font-size: 0.9em;}
  
  /* ç³»çµ±æç¤ºå¡ç‰‡ (RAG/ä»»å‹™) */
  .system-card {
    align-self: center; background: rgba(0,0,0,0.6); color: #fff;
    padding: 5px 15px; border-radius: 20px; font-size: 0.75em;
    margin: 10px 0; border: 1px solid rgba(255,255,255,0.2); backdrop-filter: blur(4px);
  }
  
  /* RAG æ€è€ƒä¸­çš„å‹•ç•« */
  .thinking-dots::after {
    content: ' .'; animation: dots 1.5s steps(5, end) infinite;
  }
  @keyframes dots { 0%, 20% { content: ' .'; } 40% { content: ' ..'; } 60% { content: ' ...'; } 100% { content: ''; }}

  /* --- è¼¸å…¥å€åŸŸ --- */
  .input-bar {
    background: #fff; padding: 10px; display: flex; align-items: center; gap: 10px;
    border-top: 1px solid #ccc; padding-bottom: max(10px, env(safe-area-inset-bottom));
  }
  .icon-btn { font-size: 1.4em; padding: 5px; cursor: pointer; color: #555; }
  .text-input { flex: 1; background: #f2f2f5; border: none; padding: 10px 15px; border-radius: 20px; outline: none; font-size: 16px; }
  .send-btn { color: #2d68c4; font-weight: bold; cursor: pointer; border: none; background: none; padding: 5px; }

  /* --- ç›¸æ©Ÿé–ƒå…‰ç‰¹æ•ˆ --- */
  .shutter-flash {
    position: absolute; top: 0; left: 0; width: 100%; height: 100%;
    background: white; opacity: 0; pointer-events: none; z-index: 999;
  }
  .flash-active { animation: flashAnim 0.3s ease-out forwards; }
  @keyframes flashAnim { 0% { opacity: 0; } 30% { opacity: 0.9; } 100% { opacity: 0; } }

</style>
</head>
<body>

<div class="phone-frame">
  <div class="shutter-flash" id="shutterOverlay"></div>

  <div class="header">
    <div class="back-btn">â®</div>
    <div class="chat-title">å‹èˆˆè»Šç«™ ç«™é•· (é¬¼é­‚?)</div>
    <div class="header-icons">ğŸ“ â˜°</div>
  </div>

  <div class="chat-area" id="chatArea">
    <div class="system-card">ä»Šå¤©</div>
    
    <div class="msg-row other">
      <div class="avatar" style="background-image: url('https://api.dicebear.com/7.x/avataaars/svg?seed=StationMaster&clothing=graphicShirt');"></div>
      <div class="msg-content">
        <div class="sender-name">ç«™é•·</div>
        <div class="bubble">æœ«ç­è»Šæ—©å°±é–‹èµ°äº†...å¹´è¼•äººï¼Œä½ æ€éº¼é‚„åœ¨æœˆå°ä¸Šï¼Ÿ</div>
      </div>
      <div class="meta-info"><span>ä¸‹åˆ 11:58</span></div>
    </div>
  </div>

  <div class="input-bar">
    <div class="icon-btn" id="cameraBtn">ğŸ“·</div>
    <div class="icon-btn">ï¼‹</div>
    <input type="text" class="text-input" id="messageInput" placeholder="è¼¸å…¥è¨Šæ¯...">
    <button class="send-btn" id="sendBtn">å‚³é€</button>
  </div>
</div>

<script>
  // --- è®Šæ•¸èˆ‡è¨­å®š ---
  const chatArea = document.getElementById('chatArea');
  const messageInput = document.getElementById('messageInput');
  const shutterOverlay = document.getElementById('shutterOverlay');
  
  // ç‹€æ…‹æ©Ÿ: 0=é–’èŠ, 1=ä»»å‹™é–‹å§‹(å•å•é¡Œ), 2=ç­‰å¾…æ‹ç…§
  let gameState = 0; 

  // --- æ ¸å¿ƒåŠŸèƒ½ ---

  function getCurrentTime() {
    const now = new Date();
    return `${now.getHours()}:${now.getMinutes().toString().padStart(2, '0')}`;
  }

  // ç™¼é€è¨Šæ¯ (Type: 'me' æˆ– 'other')
  function addMessage(text, type, isImage = false) {
    const row = document.createElement('div');
    row.className = `msg-row ${type}`;
    const time = getCurrentTime();

    let contentHtml = `<div class="bubble">${text}</div>`;
    if (isImage) {
      contentHtml = `<div class="bubble" style="padding:0; overflow:hidden;"><img src="${text}" style="width:100%; display:block; border-radius:18px;"></div>`;
    }

    if (type === 'me') {
      row.innerHTML = `
        <div class="meta-info"><span class="read-status">å·²è®€</span><span>${time}</span></div>
        <div class="msg-content">${contentHtml}</div>`;
    } else {
      row.innerHTML = `
        <div class="avatar" style="background-image: url('https://api.dicebear.com/7.x/avataaars/svg?seed=StationMaster&clothing=graphicShirt');"></div>
        <div class="msg-content">
          <div class="sender-name">ç«™é•·</div>
          ${contentHtml}
        </div>
        <div class="meta-info"><span>${time}</span></div>`;
    }
    chatArea.appendChild(row);
    chatArea.scrollTop = chatArea.scrollHeight;
  }

  // é¡¯ç¤ºç³»çµ±è¨Šæ¯
  function addSystemMessage(text, isThinking = false) {
    const div = document.createElement('div');
    div.className = 'system-card' + (isThinking ? ' thinking-dots' : '');
    div.textContent = text;
    chatArea.appendChild(div);
    chatArea.scrollTop = chatArea.scrollHeight;
    return div;
  }

  // --- äº’å‹•é‚è¼¯ (The Brain) ---

  // 1. è™•ç†ä½¿ç”¨è€…è¼¸å…¥
  function handleSend() {
    const text = messageInput.value.trim();
    if (!text) return;
    
    addMessage(text, 'me');
    messageInput.value = '';
    
    // AI è™•ç†å»¶é²
    setTimeout(() => {
      processGameLogic(text);
    }, 1000);
  }

  // 2. è™•ç†æ‹ç…§
  document.getElementById('cameraBtn').addEventListener('click', () => {
    // é–ƒå…‰å‹•ç•«
    shutterOverlay.classList.remove('flash-active');
    void shutterOverlay.offsetWidth;
    shutterOverlay.classList.add('flash-active');

    // æ¨¡æ“¬ç…§ç‰‡ä¸Šå‚³
    setTimeout(() => {
      addMessage('https://images.unsplash.com/photo-1596825205489-9a1d7c30055d?auto=format&fit=crop&q=80&w=300', 'me', true);
      
      // è§¸ç™¼å¤šæ¨¡æ…‹åˆ†æ
      setTimeout(() => {
         // å¦‚æœæ˜¯åœ¨ç­‰å¾…æ‹ç…§çš„ç‹€æ…‹
         if (gameState === 2) {
           simulateAIProcessing("Multimodal Analysis", "æ­£åœ¨è§£æå½±åƒç‰¹å¾µ...");
         } else {
           addMessage("é€™ç…§ç‰‡...é›–ç„¶æ‹å¾—ä¸éŒ¯ï¼Œä½†æˆ‘ç¾åœ¨ä¸æ˜¯è¦çœ‹é€™å€‹ã€‚", 'other');
         }
      }, 1000);
    }, 400);
  });

  // 3. AI é‚è¼¯æ ¸å¿ƒ (RAG + Agent)
  function processGameLogic(userText) {
    // ç‹€æ…‹ 0: è§¸ç™¼ä»»å‹™
    if (gameState === 0) {
      if (userText.includes("é¬¼") || userText.includes("èª°") || userText.includes("ä½ å¥½")) {
        addMessage("å™“...åˆ¥é‚£éº¼å¤§è²ã€‚æ—¢ç„¶ä½ çœ‹å¾—åˆ°æˆ‘ï¼Œä»£è¡¨ä½ è·Ÿé€™è£¡æœ‰ç·£ã€‚", 'other');
        setTimeout(() => {
            addMessage("è€ƒè€ƒä½ ï¼Œä½ çŸ¥é“å‹èˆˆè»Šç«™ä»¥å‰æ˜¯è¢«ç¨±ç‚ºã€Œåå…­ä»½ã€å—ï¼Ÿ", 'other');
            gameState = 1;
        }, 1500);
      } else {
        addMessage("æˆ‘è½ä¸å¤ªæ¸…æ¥š...æœˆå°é¢¨å¤ªå¤§äº†ã€‚", 'other');
      }
    } 
    // ç‹€æ…‹ 1: å•ç­” (RAG ä»‹å…¥)
    else if (gameState === 1) {
      const thinkingMsg = addSystemMessage("ğŸ” RAG è³‡æ–™åº«æª¢ç´¢ä¸­", true);
      
      setTimeout(() => {
        thinkingMsg.remove(); // ç§»é™¤æ€è€ƒå‹•ç•«
        
        if (userText.includes("åå…­ä»½") || userText.includes("çŸ¥é“") || userText.includes("æ¨Ÿè…¦")) {
          // RAG æª¢ç´¢æˆåŠŸ
          addSystemMessage("âœ… é©—è­‰å²å¯¦ï¼šåå…­ä»½/æ¨Ÿè…¦å¯®");
          addMessage("æ²’éŒ¯ï¼ä»¥å‰é€™è£¡æœ‰å¾ˆå¤šæ¨Ÿè…¦å¯®ã€‚çœ‹ä¾†ä½ ä¸æ˜¯æ™®é€šçš„è§€å…‰å®¢ã€‚", 'other');
          setTimeout(() => {
            addMessage("é‚£ä½ èƒ½å¹«æˆ‘ä¸€å€‹å¿™å—ï¼Ÿæˆ‘æ‰¾ä¸åˆ°ä»¥å‰çš„ã€Œè™ŸèªŒç‡ˆã€äº†ã€‚å»å¹«æˆ‘æ‹ä¸€å¼µç…§ç‰‡å›ä¾†ã€‚", 'other');
            gameState = 2; // é€²å…¥æ‹ç…§ä»»å‹™
          }, 1500);
        } else {
          addMessage("çœ‹ä¾†ä½ å°é€™è£¡çš„æ­·å²é‚„ä¸å¤ äº†è§£...å»æŸ¥æŸ¥ã€Œåå…­ä»½ã€å†å›ä¾†æ‰¾æˆ‘ã€‚", 'other');
        }
      }, 2000);
    }
  }

  // 4. æ¨¡æ“¬ AI åˆ†æ (å½±åƒè¾¨è­˜)
  function simulateAIProcessing(type, desc) {
    const sysMsg = addSystemMessage(`ğŸ‘ï¸ ${desc}`, true);
    
    setTimeout(() => {
      sysMsg.remove();
      if (gameState === 2) {
        addSystemMessage("âœ… å½±åƒè¾¨è­˜ï¼šèˆŠå±±ç·šè™ŸèªŒç‡ˆ (ä¿¡å¿ƒåº¦ 98%)");
        addMessage("å°ï¼å°±æ˜¯é€™å€‹ï¼è€æœ‹å‹...å¥½ä¹…ä¸è¦‹äº†ã€‚", 'other');
        addMessage("é€™å¯æ˜¯ç•¶å¹´ç¢ºä¿ç«è»Šä¸æœƒç›¸æ’çš„é‡è¦è¨­å‚™å•Šã€‚", 'other');
        addMessage("ğŸ‰ ä»»å‹™å®Œæˆï¼ç²å¾—ã€Œæ™‚ç©ºæ—…äººã€å¾½ç« ã€‚", 'other');
      }
    }, 2500);
  }

  // ç¶å®šæŒ‰éµ
  document.getElementById('sendBtn').addEventListener('click', handleSend);
  messageInput.addEventListener('keypress', (e) => { if(e.key === 'Enter') handleSend(); });

</script>

</body>
</html>

</body>
</html>
